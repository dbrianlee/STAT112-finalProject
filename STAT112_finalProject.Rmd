---
title: "STAT112 - Spotify Final Project"
author: "Brian Lee, Alex Ismail, Malek Kaloti"
date: "3/10/2021"
output: html_document
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE, error=TRUE, message=FALSE, warning=FALSE)
```

```{r}
#loading packages
library(lubridate)
library(dplyr)
library(tidyverse)
library(ggridges) # for joy plots
library(plotly) 
library(gganimate)     # for adding animation layers to ggplots
library(gifski)        # for creating the gif (don't need to load this library every time,but need it installed)
```

```{r}
#loading data
spotify <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-21/spotify_songs.csv')
```

# Introduction & Background

Why did we do an analysis on spotify? Why is the data significant & why should people care? In troduce the data to audience

```{r}
prelim_graph <- spotify %>%
  ggplot(aes(y = playlist_genre, x = track_popularity)) +
  labs(title = "Song Popularity by Genre",
       x = "", y = "",
       subtitle = "Song popularity is measured from 0-100, with higher numbers being indiciative of more popularity.\nHighest median popularities belong to pop and latin with an overall median popularity of 40",
       caption = "Alex Ismail, Malek Kaloti, Brian Lee") +
  theme_classic() + # Choosing a theme
  theme(plot.title.position = "plot",
        plot.title = element_text(size = 20, face = "bold"),
        plot.subtitle = element_text(size = 10, face = "italic")) +
  geom_boxplot() +
  geom_vline(aes(xintercept = median(track_popularity, na.rm = TRUE)), color = "blue") 

prelim_graph
```


```{r fig.width=10, fig.height=8}
feature_names <- names(spotify)[12:23]

density_plot <- spotify %>%
  select(c('playlist_genre', feature_names)) %>%
  pivot_longer(cols = feature_names) %>%
  ggplot(aes(x = value)) +
  geom_density(aes(color = playlist_genre), alpha = 0.5) +
  facet_wrap(~name, ncol = 3, scales = 'free') +
  labs(title = 'Spotify Audio Feature Density - by Genre',
       x = '', y = 'density') +
  theme(axis.text.y = element_blank())

ggplotly(density_plot)
```

```{r}
spotify %>% 
  filter(track_popularity >= 75) %>%
ggplot(aes(x = track_popularity, y = playlist_genre)) +
  labs(x = "Popularity", y = "Playlist Genre") +
  geom_density_ridges() + 
  theme_ridges()
#get rid of axes, add a more descriptive subtitle
```



# Data Collection
Data retrieved from github, (add link).


# R&B Music: an Analysis
```{r}
randb <- spotify %>%
  filter(playlist_genre == "r&b") %>%
  select(-track_id, - track_album_id, -playlist_id) %>%
  filter(track_popularity >= 75)

randb
```

```{r fig.width = 7, fig.length = 5, eval = FALSE}
randb %>% 
  ggplot(aes(x = track_popularity, fill = playlist_subgenre, color = playlist_subgenre)) +
  geom_density(alpha = 0.1) +
  labs(title = "ADD TITLE",
       subtitle = "R&B Subgenre: {closest_state}") +
  transition_states(playlist_subgenre, transition_length = 3, state_length = 1)
#get rid of axes, make subtitle descriptive
anim_save("randb_density.gif")

```
```{r}
knitr::include_graphics("randb_density.gif")
```



Why do hip pop and urban contemp have such similar density curves? For this section I want to look at the features of these two genres specifically.




```{r}
randb %>%
  group_by(playlist_subgenre) %>%
  filter(playlist_subgenre == c("hip pop", "urban contemporary")) %>%
  summarise_at(c("track_popularity", "danceability", "energy", "key", "loudness", "mode", "speechiness", "instrumentalness", "liveness", "valence", "tempo", "duration_ms"), mean, na.rm = TRUE) %>%
  knitr::kable() 
# maybe somehow graph this??
```





